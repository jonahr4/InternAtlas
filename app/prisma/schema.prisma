generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum LocationType {
  REMOTE
  HYBRID
  ONSITE
  UNKNOWN
}

enum EmploymentType {
  INTERN
  NEW_GRAD
  FULL_TIME
  UNKNOWN
}

enum SourcePlatform {
  GREENHOUSE
  LEVER
  WORKDAY
  ICIMS
  SMARTRECRUITERS
  CUSTOM
}

enum JobStatus {
  ACTIVE
  CLOSED
  UNKNOWN
}

model Company {
  id        String   @id @default(cuid())
  name      String   @unique
  platform  SourcePlatform
  boardUrl  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  firstCrawledAt DateTime?

  jobs Job[]
}

model Job {
  id               String         @id @default(cuid())
  companyId        String
  company          Company        @relation(fields: [companyId], references: [id])
  title            String
  location         String?
  locationType     LocationType   @default(UNKNOWN)
  employmentType   EmploymentType @default(UNKNOWN)
  postedAt         DateTime?
  jobUrl           String
  applyUrl         String?
  descriptionText  String?
  requirementsText String?
  sourcePlatform   SourcePlatform
  rawPayload       Json?
  externalId       String?
  dedupeKey        String?
  firstSeenAt      DateTime       @default(now())
  lastSeenAt       DateTime       @default(now())
  status           JobStatus      @default(ACTIVE)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@index([companyId])
  @@index([status])
  @@index([postedAt])
  @@index([lastSeenAt])
  @@index([createdAt])
  @@index([employmentType])
  @@index([locationType])
  @@index([sourcePlatform])
  @@index([title])
  @@index([location])
  // Composite indexes for common filter + sort combinations
  @@index([status, postedAt])
  @@index([status, lastSeenAt])
  @@index([status, createdAt])
  @@index([employmentType, postedAt])
  @@index([companyId, postedAt])
  @@unique([sourcePlatform, externalId])
  @@unique([dedupeKey])
}
